<div style="display:none;">Teachable Machine Audio Model</div>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.4.0/dist/speech-commands.min.js"></script>

<script type="text/javascript">
const URL = "https://teachablemachine.withgoogle.com/models/OCmF1CcyK/";

async function createModel() {
    const checkpointURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    const recognizer = speechCommands.create(
        "BROWSER_FFT",
        undefined,
        checkpointURL,
        metadataURL
    );

    await recognizer.ensureModelLoaded();
    return recognizer;
}

async function init() {
    const recognizer = await createModel();
    const classLabels = recognizer.wordLabels();

    recognizer.listen(result => {
        const scores = result.scores;
        let maxScore = 0;
        let detectedClass = "";
        for (let i = 0; i < classLabels.length; i++) {
            if (scores[i] > maxScore) {
                maxScore = scores[i];
                detectedClass = classLabels[i];
            }
        }
        // EnvÃ­a el resultado a App Inventor
        if (maxScore > 0.75) {
            window.AppInventor.setWebViewString(detectedClass);
        }
    }, {
        includeSpectrogram: false,
        probabilityThreshold: 0.75,
        invokeCallbackOnNoiseAndUnknown: true,
        overlapFactor: 0.5
    });
}
</script>
